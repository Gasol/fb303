#!/usr/bin/make -f

PYVERS := $(shell pyversions -r)
VERSION=$(shell dpkg-parsechangelog | sed -ne 's/^Version: \(.*\)/\1/p')

%:
	dh $@ --with python2

override_dh_auto_configure:
	./bootstrap.sh
	./configure --prefix=/usr --with-thriftpath=/usr --disable-static
	mkdir perl
	thrift --gen perl --out perl if/fb303.thrift

override_dh_auto_build:
	cd cpp && make install DESTDIR=$(CURDIR)/tmp
	cd java && ant -Dfb303.final.name=fb303-${VERSION}

override_dh_auto_install:
	cd $(CURDIR)/py && \
	for py in $(PYVERS); do \
		$$py setup.py --root=$(CURDIR)/debian/python-fb303--prefix=/usr \
			--install-layout=deb \
	done

	# Perl
	mkdir -p $(CURDIR)/debian/libfacebook-fb303-perl/usr/share/perl5
	cp -r $(CURDIR)/perl/Facebook \
		$(CURDIR)/debian/libfacebook-fb303-perl/usr/share/perl5
